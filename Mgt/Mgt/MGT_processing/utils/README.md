# MGT utils
A collection of scripts to help with aspects of MGT design and testing

## [summarise_missing_alleles.py](summarise_missing_alleles.py)

A script to summarise the number and type of missing allele calls as well as the number of negative allele calls from preliminary allele calls produced by the reads_to_allele.py script within MGT. 

### inputs:
A folder containing a set of allele call fasta files produced by reads_to_alleles.py

### outputs:
A folder containing read2allele
Summaries are produced in two output files, one counts negative and missing alleles per locus and the other output is per strain.

### usage:

      python summarise_missing_alleles.py input_folder/

### dependencies:
 - biopython

## [generate_newlev_ap_for_grapetree.py](generate_newlev_ap_for_grapetree.py)

A script for generating a string of alleles that approximates an ST for rapid evaluation of candidate loci sets for an MGT level.
### inputs:
- An allele profile produced by MGTdb with the grapetree option selected
- A list of loci (one per line) found in the allele profile to make pseudo ST string from
### outputs:
A file containing a concatenated string of the allele profile including only loci in input list. This will behave similar to an ST assignment when displayed on grapetree with the exception of missing data causing a different type.

### usage:

      python generate_newlev_ap_for_grapetree.py -l locus_list.txt -a allele_profile.txt -o output_file.txt

### dependencies:
- pandas

## [clade_allele_ident.py](clade_allele_ident.py)

A script to identify alleles from core loci that aren specific to each clade of isolates defined in the input. One locus for each target clade can be combined to form an MGT level capable of describing those clades.
Optimal loci can be selected by balancing sensitivity and specificity with the impact of that locus selection on other clades (problematic_minor_allele_count output column) as well as the reliability of typing for that locus (locuszeros and locusnegs output columns).

### inputs:

- clade_def: a tab delimited file with first column containing isolate names and any number of subsequent columns with clade assignments for each isolate. Isolates with no clade assignment for a particular column should be left empty. (example input file in [clade_allele_ident_examples](clade_allele_ident_examples) folder)
- allele_profile: An allele profile generated by MGTdb (can be other allele profile as long as missing values are marked with 0)
### outputs

- output candidates (file ending in perc.txt) columns listed below:


| Output column                  | Description                                                                                                                                                                                                                                        | 
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Clade                          | one of the target clades specified in the clade_def file                                                                                                                                                                                           |
| Locus                          | the locus containing a specific allele to that clade                                                                                                                                                                                               |
| specific_allele                | the allele number of the above locus that is specific to the clade                                                                                                                                                                                 |
| Num_in_clade                   | the number of isolates assigned the clade in the clade_def file                                                                                                                                                                                    |
| tp                             | True Positive: number of isolates in the clade with the specific allele                                                                                                                                                                            |
| fp                             | False Positive: number of isolates not in clade with the specific allele                                                                                                                                                                           |
| fn                             | False Negative: number of isolates in the clade without the specific allele                                                                                                                                                                        |
| tn                             | True Negative: number of isolates not in clade without the specific allele                                                                                                                                                                         |
| sensitivity                    | sensitivity of the allele for the clade                                                                                                                                                                                                            |
| specificity                    | specificity of the allele for the clade                                                                                                                                                                                                            |
| minor_allele_count             | the number of isolates that call into an allele that is not the specific_allele and is not the largest non_specific allele                                                                                                                         |
| problematic_minor_allele_count | The number of isolates where a minor allele breaks another clade (described by another locus) in the analysis into two or more groups (number counted is everything except the largest of these groups). This number should be as low as possible. |
| locuszeros                     | The number of isolates that are missing >20% of this locus in the whole isolate dataset                                                                                                                                                            |
| locusnegs                      | The number of isolates that are missing up to 20% of this locus in the whole isolate dataset                                                                                                                                                       |

### usage

    python clade_allele_ident.py -c clade_def.txt -a allele_profile.txt -o output_prefix

    Optional inputs:
    --ignore_loci       A file containing a list of loci (one per line) that should not be considered
    --sens_cutoff       minimum sensitivity of a locus when describing clade of interest (default = 0.3)
    --spec_cutoff       minimum specificity of a locus when describing clade of interest (default = 0.8)
    --clade_sets        The column name or names (comma separated) that should be checked for clade definitions (multiple columns allows each strain to be assigned more than one clade) (default = all)
    --target_clades     The clade IDs to search within the clade sets columns (default = all)
    --cladeidcol        The column name in the clade_def file that contains the strain IDs that match the allele profile file (default = Strain)
    --apidcol           The column name in the allele profile file that contains the strain IDs that match the clade def file (default = Strain)
    --showneg           do not replace negative alleles with positive in output allele profiles

### dependencies
 - pandas
 - numpy